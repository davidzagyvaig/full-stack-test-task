<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Védett oldal</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 800px; margin: 40px auto; }
    .row { display:flex; gap: 16px; align-items:flex-start; }
    .col { flex:1; border:1px solid #ddd; padding:16px; border-radius:8px; }
    code { background:#f6f8fa; padding:2px 4px; border-radius:4px; }
    button { padding:8px 12px; cursor:pointer; }
    table { border-collapse: collapse; width:100%; }
    th, td { border:1px solid #ddd; padding:8px; text-align:left; }
    .muted { color:#666; }
  </style>
</head>
<body>
  <h1>Üdv a védett oldalon</h1>
  <p>Ez az oldal a userhez rendelt <em>connection</em> tokent használja a külső API hívásokhoz.</p>
  <div class="row">
    <div class="col">
      <h2>Profil adatok (reqres)</h2>
      <p><button id="load">Adatok lekérése</button> <span id="status" class="muted"></span></p>
      <pre id="out">{}</pre>
    </div>
    <div class="col">
      <h2>Pool állapot</h2>
      <p><button id="pool">Pool frissítése</button></p>
      <table>
        <thead><tr><th>ID</th><th>Státusz</th><th>Assigned</th><th>Last ping</th></tr></thead>
        <tbody id="pool_tbody"></tbody>
      </table>
    </div>
  </div>
  <p><a href="/logout">Kijelentkezés</a></p>
  <script>
    const out = document.getElementById('out');
    const status = document.getElementById('status');
    const poolBody = document.getElementById('pool_tbody');

    document.getElementById('load').addEventListener('click', async () => {
      status.textContent = " (töltés...)";
      const r = await fetch('/api/me');
      const j = await r.json();
      status.textContent = "";
      out.textContent = JSON.stringify(j, null, 2);
    });

    document.getElementById('pool').addEventListener('click', async () => {
      const r = await fetch('/api/pool');
      const j = await r.json();
      poolBody.innerHTML = j.connections.map(c => (
        `<tr><td>${c.id}</td><td>${c.status}</td><td>${c.assigned_count}</td><td>${c.last_ping ?? ""}</td></tr>`
      )).join("");
    });
  </script>
</body>
</html>
